<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뉴키즈 - 통합 관리자 시스템</title>

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin.css">
    <style>
        .color-picker-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .color-picker-label {
            font-size: 0.7rem;
            color: #666;
        }

        .opacity-val {
            font-size: 0.75rem;
            color: #1a3c6e;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 5px;
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">처리 중입니다...</div>
    <div id="login-section">
        <div class="login-box">
            <h2 style="text-align:center; margin-bottom:30px; color:#1a3c6e;">🔒 관리자 로그인</h2>
            <div class="form-group"><label class="form-label">아이디</label><input type="email" id="admin-email" class="form-input" placeholder="admin@newkids.com"></div>
            <div class="form-group" style="margin-top:15px;"><label class="form-label">비밀번호</label><input type="password" id="admin-password" class="form-input" placeholder="비밀번호"></div>
            <div class="btn-center-wrap"><button onclick="adminLogin()" class="btn-action" style="width: 100%;">로그인</button></div>
            <p style="text-align:center; margin-top:20px; font-size:0.9rem;"><a href="index.html" style="color:#666;">← 홈페이지로 돌아가기</a></p>
        </div>
    </div>

    <div id="admin-layout" class="admin-layout" style="display:none;">
        <nav class="sidebar">
            <div class="sidebar-logo">🏢 <span>뉴키즈 관리자</span></div>
            <div class="nav-item active" onclick="switchTab('dashboard', this)">📊 <span class="nav-text">대시보드</span></div>
            <div class="nav-item" onclick="switchTab('posts', this)">📝 <span class="nav-text">게시글 관리</span></div>
            <div class="nav-item" onclick="switchTab('category', this)">🖼️ <span class="nav-text">서브 페이지 관리</span></div>
            <div class="nav-item" onclick="switchTab('sheets', this)">📑 <span class="nav-text">신청서 확인</span></div>
            <div class="nav-item" onclick="switchTab('settings', this)">⚙️ <span class="nav-text">환경 설정</span></div>
            <div class="nav-item" onclick="location.href='index.html'">🏠 <span class="nav-text">홈페이지 이동</span></div>
            <div class="nav-item logout-btn" onclick="adminLogout()">🚪 <span class="nav-text">로그아웃</span></div>
        </nav>

        <main class="main-content">
            <div id="tab-dashboard" class="admin-section active">
                <h1 style="color:#333; border-bottom:2px solid #ddd; padding-bottom:15px;">관리자 대시보드</h1>
                <div class="dash-grid">
                    <div class="dash-card" onclick="switchTab('posts', document.querySelectorAll('.nav-item')[1])"><span class="dash-icon">📝</span><div class="dash-title">게시글 작성하기</div></div>
                    <div class="dash-card" onclick="switchTab('category', document.querySelectorAll('.nav-item')[2])"><span class="dash-icon">🖼️</span><div class="dash-title">서브 페이지 관리</div></div>
                    <div class="dash-card" onclick="openSavedSheet()"><span class="dash-icon">📊</span><div class="dash-title">신청서 확인</div></div>
                    <div class="dash-card" onclick="switchTab('settings', document.querySelectorAll('.nav-item')[4])"><span class="dash-icon">⚙️</span><div class="dash-title">환경 설정</div></div>
                </div>
            </div>

            <div id="tab-posts" class="admin-section">
                <div class="panel-box">
                    <h2 id="form-title" style="border-bottom:2px solid #1a3c6e; padding-bottom:15px; margin-bottom:20px;">📝 게시글 작성/수정</h2>
                    <div style="background:#fff3cd; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #ffeeba;">
                        <label style="font-weight:bold; margin-right:20px; color:#856404;">📢 노출 위치 선택</label>
                        <div style="display:inline-flex; gap:20px; align-items:center;">
                            <label style="cursor:pointer; display:flex; align-items:center;"><input type="checkbox" id="chk-intro" checked onchange="toggleEditorState()" style="width:18px; height:18px; margin-right:5px;"><strong>소개 페이지</strong></label>
                            <label style="cursor:pointer; display:flex; align-items:center;"><input type="checkbox" id="chk-order" onchange="toggleEditorState()" style="width:18px; height:18px; margin-right:5px;"><strong>발주 페이지</strong></label>
                        </div>
                    </div>
                    <input type="file" id="hidden-image-input" accept="image/*" multiple style="display:none;">
                    <div class="write-inline-row">
                        <div class="form-group w-col-order" style="margin-bottom:0;"><label class="form-label">순서</label><input type="number" id="post-order" class="form-input" value="0" style="text-align:center; padding: 12px 5px;"></div>
                        <div class="form-group w-col-category" style="margin-bottom:0;"><label class="form-label">카테고리</label><select id="post-category" class="form-input"><option value="">로딩 중...</option></select></div>
                        <div class="form-group w-col-title" style="margin-bottom:0;"><label class="form-label">제목 (교재명)</label><input type="text" id="post-title" class="form-input" placeholder="제목을 입력하세요"></div>
                    </div>
                    <div class="form-group"><label class="form-label">썸네일 이미지</label><input type="file" id="post-thumb-file" class="form-input" accept="image/*"><div id="thumb-manage-area" style="display:none; margin-top:5px;"><label><input type="checkbox" id="delete-thumb-check"> 기존 썸네일 삭제</label></div></div>
                    <div class="form-group" id="editor-area"><label class="form-label">내용</label><div id="editor-container"></div></div>
                    <div class="form-group" style="margin-top:20px;"><label class="form-label">상세 이미지/동영상</label><input type="file" id="post-file" class="form-input" accept="image/*,video/*"><div id="file-manage-area" style="display:none; margin-top:5px;"><label><input type="checkbox" id="delete-file-check"> 기존 파일 삭제</label></div></div>
                    <div class="form-grid"><div class="form-group"><label class="form-label">유튜브 URL</label><input type="text" id="youtube-url" class="form-input"></div><div class="form-group"><label class="form-label">링크 URL</label><input type="text" id="post-link" class="form-input"></div></div>
                    <div class="btn-center-wrap"><button id="btn-submit" onclick="uploadPost()" class="btn-action" style="min-width: 200px;">업로드 저장</button><button id="btn-cancel-edit" onclick="cancelEdit()" class="btn-action" style="display:none; background-color:#666;">취소</button></div>
                </div>
                <div class="panel-box" style="margin-top: 30px;">
                    <div class="admin-list-header"><h3 style="margin:0;">📂 등록된 게시글 목록</h3><select id="filter-category" class="form-input" style="width:auto;" onchange="loadManageList(1)"></select></div>
                    <div id="manage-list"></div><div id="pagination-controls" class="pagination"></div>
                </div>
            </div>

            <div id="tab-category" class="admin-section">
                <h2 style="border-bottom:2px solid #1a3c6e; padding-bottom:15px;">🖼️ 서브 페이지 관리</h2>
                <div class="panel-box" style="margin-bottom:30px; border:2px dashed #1a3c6e; background:#f0f7ff;">
                    <h3 style="margin-bottom:15px; color:#1a3c6e;">➕ 새 카테고리(메뉴) 추가</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-end;">
                        <div class="form-group" style="flex: 0 0 150px; margin-bottom:0;"><label class="form-label">유형</label><select id="new-cat-type" class="form-input"><option value="EDU">교육 (child.html)</option><option value="EVENT">행사 (program.html)</option><option value="BOARD">📌 게시판 전용</option><option value="PAGE">⚙️ 고정 페이지 (견적/발주)</option></select></div>
                        <div class="form-group" style="flex: 0 0 150px; margin-bottom:0;"><label class="form-label">코드 (영문)</label><input type="text" id="new-cat-code" class="form-input" placeholder="예: cooking"></div>
                        <div class="form-group" style="flex: 1; margin-bottom:0;"><label class="form-label">메뉴 이름</label><input type="text" id="new-cat-name" class="form-input" placeholder="예: 요리 활동"></div>
                    </div>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-end;">
                        <div class="form-group" style="flex: 1; margin-bottom:0;"><label class="form-label">배경 이미지</label><input type="file" id="new-cat-file" class="form-input" accept="image/*" style="background:#fff;"></div>
                        <div class="form-group" style="flex: 2; margin-bottom:0;"><label class="form-label">설명글</label><input type="text" id="new-cat-desc" class="form-input"></div>
                    </div>
                    <div style="text-align: right;"><button onclick="addNewCategory()" class="btn-action">카테고리 생성</button></div>
                </div>
                <div class="panel-box">
                    <p style="color:#666; margin-bottom:20px;">
                        <strong>[M색]</strong> 메뉴명, <strong>[T색]</strong> 제목, <strong>[C색]</strong> 설명글, <strong>[O색]</strong> 오버레이 색상입니다.<br>
                        배경색 변경 버튼은 제거되었습니다.
                    </p>
                    <div id="category-list-container">로딩 중...</div>
                </div>
            </div>

            <div id="tab-sheets" class="admin-section">
                <h2 style="border-bottom:2px solid #1a3c6e; padding-bottom:15px;">📑 신청서 관리</h2>
                <div class="form-group"><label class="form-label">🔗 구글 시트 주소</label><div style="display:flex; gap:10px;"><input type="text" id="sheet-url-input" class="form-input"><button onclick="saveSheetUrl()" class="btn" style="width:100px;">저장</button></div></div>
                <div class="dash-grid" style="margin-top:40px;"><div class="dash-card" onclick="openSavedSheet()"><span class="dash-icon" style="color:#2ecc71;">📊</span><div class="dash-title">구글 시트 열기</div></div></div>
            </div>

            <div id="tab-settings" class="admin-section">
                <h2 style="border-bottom:2px solid #1a3c6e; padding-bottom:15px;">⚙️ 환경 설정</h2>
                <div class="panel-box">
                    <h3 class="form-section-title">🏠 메인 페이지(첫 화면) 관리</h3>
                    <div style="background:#f9f9f9; padding:30px; border-radius:12px; border:1px solid #eee;">
                        <div class="form-group"><label class="form-label">메인 큰 제목</label><input type="text" id="conf-main-title" class="form-input"></div>
                        <div class="form-group"><label class="form-label">메인 설명글</label><textarea id="conf-main-desc" class="form-inputp"></textarea></div>
                        <div class="form-group" style="margin-top:15px; border-top:1px dashed #ccc; padding-top:15px;">
                            <label class="form-label">텍스트 색상</label>
                            <div style="display:flex; gap:30px;">
                                <div class="color-picker-group"><span class="color-picker-label">큰 제목</span><input type="color" id="conf-main-title-color" style="cursor:pointer;"></div>
                                <div class="color-picker-group"><span class="color-picker-label">설명글</span><input type="color" id="conf-main-desc-color" style="cursor:pointer;"></div>
                            </div>
                        </div>
                        <div style="display:flex; gap:30px; align-items:flex-start; margin-top:30px; border-top:1px dashed #ccc; padding-top:30px;">
                            <div style="text-align:center;">
                                <p style="font-size:0.9rem; margin-bottom:10px; color:#666; font-weight:bold;">현재 배경</p>
                                <img id="preview-main-hero" src="" style="width:300px; height:170px; object-fit:cover; border-radius:8px; border:1px solid #ccc; background:#e0e0e0;">
                                <button onclick="deleteMainHeroImage()" class="btn-mini" style="margin-top:10px; background:#ff6b6b; color:#fff; border:none; width:100%;">🗑️ 이미지 삭제</button>
                            </div>
                            <div style="flex:1;">
                                <label class="form-label">배경 이미지 변경</label><input type="file" id="conf-main-hero" class="form-input" accept="image/*">
                                <div style="display:flex; gap:30px; margin-top:20px;">
                                    <div><label class="form-label">배경 색상</label><input type="color" id="conf-main-bg-color" style="height:40px; cursor:pointer;"></div>
                                    <div><label class="form-label">오버레이 색상</label><input type="color" id="conf-main-overlay-color" style="height:40px; cursor:pointer;"></div>
                                    <div><label class="form-label">투명도</label><div style="display:flex; align-items:center; gap:10px;"><input type="range" id="conf-main-overlay-opacity" min="0" max="1" step="0.1" oninput="document.getElementById('op-val-main').innerText=this.value"><span id="op-val-main" class="opacity-val">0.4</span></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h3 class="form-section-title" style="margin-top:40px;">🏢 회사 정보 & 🎨 디자인</h3>
                    <div class="form-grid"><div class="form-group"><label class="form-label">회사명</label><input type="text" id="conf-name" class="form-input"></div><div class="form-group"><label class="form-label">대표자</label><input type="text" id="conf-ceo" class="form-input"></div></div>
                    <div class="form-group"><label class="form-label">주소</label><input type="text" id="conf-addr" class="form-input"></div><div class="form-group"><label class="form-label">연락처</label><input type="text" id="conf-phone" class="form-input"></div>
                    <div class="form-grid"><div class="form-group"><label class="form-label">메인 컬러</label><input type="color" id="conf-primary" class="form-input" style="height:50px;"></div><div class="form-group"><label class="form-label">강조 컬러</label><input type="color" id="conf-accent" class="form-input" style="height:50px;"></div></div>
                    <div class="btn-center-wrap"><button onclick="saveSiteConfig()" class="btn-action">설정 저장하기</button></div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://unpkg.com/quill-blot-formatter@1.0.5/dist/quill-blot-formatter.min.js"></script>
    <script src="config.js"></script>
    <script src="manager.js"></script>

    <script>
        let editingId = null; let originalDetailUrl = null; let originalThumbUrl = null; let originalMainHero = null; let isMainHeroDeleted = false; let quill; const ITEMS_PER_PAGE = 12; let currentPage = 1; let categoryList = []; const FLAG_ORDER_ONLY = 'ORDER_ITEM'; const FLAG_ORDER_ALL = 'ORDER_ALL';
        function getYoutubeId(url) { if (!url) return null; const m = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/); return (m && m[2].length === 11) ? m[2] : null; }
        function getFirstImageFromContent(html) { const d = document.createElement('div'); d.innerHTML = html; const i = d.querySelector('img'); return i ? i.src : null; }

        document.addEventListener("DOMContentLoaded", async function () {
            Quill.register('modules/blotFormatter', QuillBlotFormatter.default);
            quill = new Quill('#editor-container', { theme: 'snow', modules: { blotFormatter: {}, toolbar: { container: [[{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline', { 'color': [] }, { 'background': [] }], [{ 'align': [] }, 'link', 'image', 'video']], handlers: { image: function () { document.getElementById('hidden-image-input').click(); } } } } });
            document.getElementById('hidden-image-input').addEventListener('change', function () { if (this.files.length > 0) uploadAndInsertImages(this.files); });
            const savedUrl = localStorage.getItem('mySheetUrl'); if (savedUrl) document.getElementById('sheet-url-input').value = savedUrl;
            try { const { data: { session } } = await window.sb.auth.getSession(); if (session) { showAdminMode(); loadConfigToForm(); loadAdminCategories(); populateCategorySelects(); } else { document.getElementById('login-section').style.display = 'flex'; } } catch (e) { console.error(e); }
        });

        // [1. 카테고리/페이지 관리]
        async function loadAdminCategories() {
            const listDiv = document.getElementById('category-list-container');
            try {
                const { data, error } = await window.sb.from('program_categories').select('*').order('order_num', { ascending: true });
                if (error) throw error;
                if (!data || data.length === 0) { listDiv.innerHTML = "<div style='text-align:center; padding:30px;'>카테고리 없음</div>"; return; }

                categoryList = data;
                let html = `<div style="text-align:right; margin-bottom:10px;"><button onclick="saveAllCategories()" class="btn-action" style="background:#2ecc71; border:none; padding:10px 20px;">💾 변경사항 일괄 저장</button></div>`;

                // [수정됨] B색 삭제, M색 추가, 순서 변경 (M -> T -> C -> O)
                const gridStyle = "grid-template-columns: 60px 40px 70px 100px 100px 35px 35px 35px 35px 50px 1fr 120px 50px 60px;";
                html += `<div class="cat-manage-layout cat-manage-header" style="${gridStyle}">
                        <div>유형</div><div>순서</div><div>코드</div><div>메뉴명</div><div>제목</div><div>M색</div><div>T색</div><div>C색</div><div>O색</div><div>투명도</div><div>설명글</div><div>이미지</div><div>노출</div><div>삭제</div>
                    </div>`;

                data.forEach((cat, index) => {
                    const thumb = cat.hero_image || 'https://via.placeholder.com/50?text=None';
                    // 값 로드 (기본값 처리)
                    const menuColor = cat.menu_text_color || '#333333';
                    const titleColor = cat.hero_title_color || '#ffffff';
                    const descColor = cat.hero_desc_color || '#ffffff';
                    const overlayColor = cat.hero_overlay_color || '#1a3c6e';
                    const overlayOpacity = cat.hero_overlay_opacity !== undefined ? cat.hero_overlay_opacity : 0.8;

                    let badgeColor = '#999'; let badgeText = cat.type;
                    if (cat.type === 'EDU') { badgeColor = '#1a3c6e'; badgeText = '교육'; }
                    else if (cat.type === 'EVENT') { badgeColor = '#f4a261'; badgeText = '행사'; }
                    else if (cat.type === 'BOARD') { badgeColor = '#27ae60'; badgeText = '게시판'; }
                    else if (cat.type === 'PAGE') { badgeColor = '#666'; badgeText = '페이지'; }

                    const isVisible = cat.is_visible !== false;
                    const visBtn = isVisible ? `<button class="btn-mini" style="background:#27ae60; color:#fff;" onclick="toggleVisibility('${cat.code}', false)">ON</button>` : `<button class="btn-mini" style="background:#999; color:#fff;" onclick="toggleVisibility('${cat.code}', true)">OFF</button>`;

                    html += `<div class="cat-manage-layout cat-manage-row" style="${gridStyle}">
                            <div class="cat-cell-center"><span class="type-badge" style="background:${badgeColor}">${badgeText}</span></div>
                            <div class="cat-cell-center"><button class="btn-order" onclick="moveCategory(${index}, -1)">▲</button><button class="btn-order" onclick="moveCategory(${index}, 1)">▼</button></div>
                            <div class="cat-cell-center" style="font-weight:bold; font-size:0.8rem;">${cat.code}</div>

                            <div class="cat-cell-input"><input type="text" id="name-${cat.code}" value="${cat.name}"></div>
                            <div class="cat-cell-input"><input type="text" id="title-${cat.code}" value="${cat.hero_title || ''}"></div>

                            <div class="cat-cell-center"><input type="color" id="m-color-${cat.code}" value="${menuColor}" title="메뉴명 색상" style="width:25px; border:none; background:none; cursor:pointer;"></div>
                            <div class="cat-cell-center"><input type="color" id="t-color-${cat.code}" value="${titleColor}" title="제목 색상" style="width:25px; border:none; background:none; cursor:pointer;"></div>
                            <div class="cat-cell-center"><input type="color" id="d-color-${cat.code}" value="${descColor}" title="설명 색상" style="width:25px; border:none; background:none; cursor:pointer;"></div>
                            <div class="cat-cell-center"><input type="color" id="o-color-${cat.code}" value="${overlayColor}" title="오버레이 색상" style="width:25px; border:none; background:none; cursor:pointer;"></div>

                            <div class="cat-cell-center"><input type="number" id="o-op-${cat.code}" value="${overlayOpacity}" step="0.1" min="0" max="1" style="width:40px; padding:2px; font-size:0.8rem;"></div>
                            <div class="cat-cell-input"><input type="text" id="desc-${cat.code}" value="${cat.hero_desc || ''}"></div>

                            <div class="cat-cell-center" style="display:flex; flex-direction:column; align-items:center; gap:5px;">
                                <img src="${thumb}" style="width:50px; height:50px; object-fit:cover; cursor:pointer; border:1px solid #ddd;" onclick="document.getElementById('file-${cat.code}').click()" title="이미지 변경">
                                <input type="file" id="file-${cat.code}" style="display:none;" accept="image/*">
                                <button class="btn-mini" style="font-size:0.6rem; color:red;" onclick="deleteSubHeroImage('${cat.code}')">이미지삭제</button>
                            </div>

                            <div class="cat-cell-center">${visBtn}</div>
                            <div class="cat-cell-center"><button onclick="deleteCategory('${cat.code}')" class="btn-mini" style="background:#ff6b6b; color:#fff; width:100%;">삭제</button></div>
                        </div>`;
                });

                html += `<div style="text-align:right; margin-top:20px;"><button onclick="saveAllCategories()" class="btn-action" style="background:#2ecc71; border:none; padding:12px 30px; font-size:1rem;">💾 변경사항 일괄 저장</button></div>`;
                listDiv.innerHTML = html;
            } catch (e) { listDiv.innerHTML = "로드 실패"; console.error(e); }
        }

        async function saveAllCategories() {
            if (!confirm("모든 카테고리의 변경사항을 저장하시겠습니까?")) return;
            showLoading(true); const updatePromises = [];
            for (const cat of categoryList) {
                const code = cat.code;
                const n = document.getElementById(`name-${code}`).value;
                const t = document.getElementById(`title-${code}`).value;
                const d = document.getElementById(`desc-${code}`).value;
                // [수정됨] M색 추가, B색 제거
                const mc = document.getElementById(`m-color-${code}`).value;
                const tc = document.getElementById(`t-color-${code}`).value;
                const dc = document.getElementById(`d-color-${code}`).value;
                const oc = document.getElementById(`o-color-${code}`).value;
                const op = document.getElementById(`o-op-${code}`).value;

                const fileInput = document.getElementById(`file-${code}`);
                const file = fileInput && fileInput.files[0];

                updatePromises.push(async () => {
                    let imgUrl = null;
                    if (file) {
                        const { data, error } = await window.sb.storage.from('images').upload(`h_${Date.now()}_${code}`, file);
                        if (!error) {
                            const { data: urlData } = window.sb.storage.from('images').getPublicUrl(data.path);
                            imgUrl = urlData.publicUrl;
                        }
                    }
                    const updateData = {
                        name: n, hero_title: t, hero_desc: d,
                        menu_text_color: mc, // 메뉴명 색상 저장
                        hero_title_color: tc, hero_desc_color: dc,
                        hero_overlay_color: oc, hero_overlay_opacity: parseFloat(op)
                    };
                    if (imgUrl) updateData.hero_image = imgUrl;
                    return window.sb.from('program_categories').update(updateData).eq('code', code);
                });
            }
            try { await Promise.all(updatePromises.map(fn => fn())); showLoading(false); alert("모든 변경사항이 저장되었습니다."); loadAdminCategories(); }
            catch (e) { showLoading(false); console.error(e); alert("저장 중 오류가 발생했습니다."); }
        }

        async function addNewCategory() {
            const code = document.getElementById('new-cat-code').value.trim().toLowerCase(), name = document.getElementById('new-cat-name').value.trim(), type = document.getElementById('new-cat-type').value, desc = document.getElementById('new-cat-desc').value.trim();
            const { data } = await window.sb.from('program_categories').select('order_num').order('order_num', { ascending: false }).limit(1); const max = data && data.length > 0 ? data[0].order_num + 1 : 1;
            if (!code || !name) return alert("필수 입력");
            const f = document.getElementById('new-cat-file').files[0]; let u = null; if (f) { const { data } = await window.sb.storage.from('images').upload(`h_${Date.now()}`, f); u = window.sb.storage.from('images').getPublicUrl(data.path).data.publicUrl; }
            const { error } = await window.sb.from('program_categories').insert([{ code, name, type, hero_desc: desc, hero_image: u, order_num: max, is_visible: true }]);
            if (error) alert("실패: " + error.message); else { alert("추가됨"); document.getElementById('new-cat-code').value = ''; loadAdminCategories(); populateCategorySelects(); }
        }

        async function deleteSubHeroImage(c) { if (confirm("이미지를 삭제하시겠습니까?")) { showLoading(true); await window.sb.from('program_categories').update({ hero_image: null }).eq('code', c); showLoading(false); loadAdminCategories(); } }
        async function deleteCategory(c) { if (confirm("정말 삭제하시겠습니까?")) { await window.sb.from('program_categories').delete().eq('code', c); loadAdminCategories(); populateCategorySelects(); } }
        async function toggleVisibility(c, s) { showLoading(true); await window.sb.from('program_categories').update({ is_visible: s }).eq('code', c); loadAdminCategories(); showLoading(false); }
        async function moveCategory(i, d) { const t = i + d; if (t < 0 || t >= categoryList.length) return; const c = categoryList[i], n = categoryList[t], tmp = c.order_num; showLoading(true); await window.sb.from('program_categories').update({ order_num: n.order_num }).eq('code', c.code); await window.sb.from('program_categories').update({ order_num: tmp }).eq('code', n.code); loadAdminCategories(); showLoading(false); }
        async function populateCategorySelects() { /* 기존 유지 */ }
        window.toggleEditorState = function () { /* 기존 유지 */ }
        async function uploadPost() { /* 기존 유지 */ }
        async function loadConfigToForm() { /* 기존 유지 */ }
        window.saveSiteConfig = function () { /* 기존 유지 */ }
        window.switchTab = function (t, n) { /* 기존 유지 */ }
        window.adminLogin = async function () { /* 기존 유지 */ }
        window.adminLogout = async function () { /* 기존 유지 */ }
        function showAdminMode() { /* 기존 유지 */ }
        function showLoading(s) { /* 기존 유지 */ }
        function deleteMainHeroImage() { /* 기존 유지 */ }
        window.saveSheetUrl = function () { /* 기존 유지 */ }
        window.openSavedSheet = function () { /* 기존 유지 */ }
        async function loadManageList(p) { /* 기존 유지 */ }
        window.editPost = function (i) { /* 기존 유지 */ }
        window.cancelEdit = function () { /* 기존 유지 */ }
        window.deletePost = function (id) { /* 기존 유지 */ }
        async function uploadAndInsertImages(f) { /* 기존 유지 */ }
    </script>
</body>
</html>